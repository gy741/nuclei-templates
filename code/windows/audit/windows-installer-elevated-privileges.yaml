id: windows-installer-elevated-privileges

info:
  name: Windows Installer Elevated Privileges Enabled
  author: princechaddha
  severity: medium
  description: Checks if Windows Installer runs with elevated privileges for non-admin users, which could be exploited.
  impact: |
    Elevated privileges for the Windows Installer may allow non-administrative users to install unauthorized software.
  remediation: |
    Disable elevated privileges for non-admin users in Windows Installer settings.
  tags: installer,elevated-privileges,code,windows-audit

self-contained: true

code:
  - pre-condition: |
      IsWindows();
    engine:
      - powershell.exe
    args:
      - -ExecutionPolicy
      - Bypass
    pattern: "*.ps1"
    source: |
      if ((Get-ItemProperty -Path 'HKLM:\Software\Policies\Microsoft\Windows\Installer' -Name 'AlwaysInstallElevated' -ErrorAction SilentlyContinue).AlwaysInstallElevated -eq 1) {
        Write-Output 'Installer runs with elevated privileges';
      }

    matchers:
      - type: word
        words:
          - "Installer runs with elevated privileges"

# digest: 4a0a00473045022100aff5f5b7ccc3971d09383a9cf738d85529f3bf270ed9c1c0b79038b11a876a29022019dc601db6d487624960f92c87bdd705de0dc5f95edec2726df0681f14774dcb:922c64590222798bb761d5b6d8e72950